# دليل المطور - مسجد برو

هذا الدليل مخصص للمطورين الذين يرغبون في فهم بنية الكود والمساهمة في تطوير برنامج "مسجد برو".

## 1. التقنيات المستخدمة

- **لغة البرمجة:** Python 3
- **واجهة المستخدم (UI):** `customtkinter` - مكتبة حديثة مبنية على Tkinter.
- **قاعدة البيانات:** `sqlite3` - قاعدة بيانات مدمجة لا تتطلب تثبيت خادم.
- **التعامل مع البيانات:** `pandas` و `numpy` - لمعالجة البيانات وتحليلها، خاصة في قسم التقارير.
- **تصدير Excel:** `openpyxl` - لإنشاء وقراءة ملفات Excel (`.xlsx`).
- **إنشاء مستندات Word:** `python-docx` - لإنشاء الوصولات بصيغة (`.docx`).
- **الرسوم البيانية:** `matplotlib` - لإنشاء الرسوم البيانية في لوحة التحكم والتقارير.
- **التعامل مع الصور:** `Pillow (PIL)` - لمعالجة الصور المصغرة والمرفقات.
- **دعم اللغة العربية:** `arabic-reshaper` و `python-bidi` - لعرض النصوص العربية بشكل صحيح في الرسوم البيانية.

## 2. بنية المشروع

```
masjid_pro/
├── main.py             # الملف الرئيسي للتطبيق الذي يحتوي على كل الكود
├── requirements.txt    # قائمة المكتبات المطلوبة
├── fonts/              # مجلد يحتوي على الخطوط العربية المستخدمة
│   ├── Amiri-Regular.ttf
│   └── ...
├── icons/              # مجلد يحتوي على أيقونة البرنامج
│   └── app_icon.ico
├── attachments/        # (يتم إنشاؤه تلقائيًا) لتخزين صور المرفقات
├── receipts/           # (يتم إنشاؤه تلقائيًا) لتخزين الوصولات المنشأة
└── masjid_pro_database_v6.db # (يتم إنشاؤه تلقائيًا) ملف قاعدة البيانات
```

**ملاحظة:** يتم إنشاء قاعدة البيانات والمرفقات في مجلد `MasjidProData` داخل مجلد المستخدم الرئيسي (`~`) لضمان أن تكون البيانات قابلة للكتابة ومستقلة عن مكان تثبيت البرنامج.

## 3. نظرة عامة على الكود في `main.py`

الكود منظم في عدة فئات (Classes) رئيسية:

- **`App(ctk.CTk)`:** الفئة الرئيسية للتطبيق. هي المسؤولة عن:
  - تهيئة النافذة الرئيسية.
  - إعداد قاعدة البيانات ومجلدات البيانات.
  - التعامل مع تسجيل الدخول وإنشاء الواجهة الرئيسية.
  - إدارة عرض الإطارات (الصفحات) المختلفة.

- **`DatabaseManager`:** فئة مسؤولة عن كل عمليات قاعدة البيانات:
  - إنشاء الجداول.
  - إضافة، تحديث، حذف، وجلب البيانات (المعاملات، المستخدمين، الفئات، إلخ).
  - تسجيل الإجراءات في سجل التدقيق.

- **`FontManager` و `IconManager`:** فئات مساعدة لإدارة الخطوط والأيقونات المستخدمة في الواجهة بشكل مركزي.

- **إطارات الواجهة (Frames):** كل صفحة في التطبيق هي فئة منفصلة ترث من `ctk.CTkFrame`:
  - `LoginWindow`: نافذة تسجيل الدخول.
  - `SidebarFrame`: الشريط الجانبي للتنقل.
  - `DashboardFrame`: لوحة التحكم الرئيسية.
  - `IncomeFrame`, `ExpenseFrame`: صفحات إدارة المداخيل والمصروفات.
  - `ReportsFrame`: صفحة التقارير والتحليلات.
  - `DataManagementFrame`, `UserManagementFrame`, `AuditLogFrame`: صفحات إدارة البيانات والمستخدمين (خاصة بالمدير).

- **النوافذ الحوارية (Dialogs):** نوافذ منبثقة لإدخال البيانات:
  - `DataEntryDialog`: لإضافة أو تعديل المداخيل والمصروفات.
  - `UserDialog`: لإضافة أو تعديل المستخدمين.
  - `CategoryDialog`: لإدارة الفئات.

## 4. قاعدة البيانات

قاعدة البيانات `sqlite3` تحتوي على الجداول التالية:
- `incomes`: لتسجيل المداخيل.
- `expenses`: لتسجيل المصروفات.
- `users`: لتخزين معلومات المستخدمين وكلمات المرور (المجزأة بـ SHA256).
- `audit_log`: سجل التدقيق.
- `income_categories`, `expense_categories`: لتخزين فئات المداخيل والمصروفات.
- `members`, `activities`, `activity_attendance`: لإدارة الأعضاء والأنشطة.
- `settings`: لتخزين الإعدادات العامة للبرنامج.

## 5. كيفية المساهمة

1.  **Fork the repository:** قم بعمل نسخة من المشروع إلى حسابك.
2.  **Create a new branch:** قم بإنشاء فرع جديد لتطوير ميزة جديدة أو إصلاح خلل.
    ```bash
    git checkout -b feature/my-new-feature
    ```
3.  **Make your changes:** قم بإجراء التعديلات على الكود.
4.  **Test your changes:** تأكد من أن التغييرات التي أجريتها لا تكسر أي وظائف حالية وأنها تعمل كما هو متوقع.
5.  **Commit your changes:** قم بحفظ التغييرات مع رسالة واضحة تصف ما قمت به.
    ```bash
    git commit -m "Add: My new feature"
    ```
6.  **Push to the branch:** قم برفع التغييرات إلى الفرع الخاص بك.
    ```bash
    git push origin feature/my-new-feature
    ```
7.  **Submit a pull request:** قم بإنشاء طلب سحب (Pull Request) من فرعك إلى الفرع الرئيسي للمشروع الأصلي.
